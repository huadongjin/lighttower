### HTTP 到 HTTPS 的必要性

### http的不足：
- 通信使用明文（不加密），内容可能会被窃听
- 不验证通信方的身份，因此有可能遭遇伪装
- 无法证明报文的完整性，所有有可能遭到篡改


#### **通信使用明文可能会被窃听**
由于 HTTP 本身不具备加密的功能，所以也无法做到对通信整体（通信的请求和响应的内容）进行加密。也就是说 HTTP 报文使用明文方式发送的。

为什么通信是不加密是一个缺点？
这是因为按 TCP/IP 协议族的工作机制，通信内容在所有的通信线路上都有可能遭到窃视。互联网是由能连通到全世界的网络组成的。无论世界哪个角落的服务器在和客户端通信时，在此通信线路上的某些网络设备、光缆、计算机等都不可能是个人的私有物品，所以不排除某个环节中会遭到恶意窥视的行为。

被加密处理的通信还是被窥视吗？
会的，这一点和未加密的报文一样，只不过看到的是已经加密过的通信报文。窃听相同段上的通信并非难事。只需要收集在互联网上流动的数据包（数据帧），对于收集来的数据包的解析工作可以交由专门的工具来完成，如：packet capture 或嗅探器（sniffer）.


如何防止窃听保护信息的几种对策中，普及的就是加密技术。

**通信的加密：**
解决的办法一种方式是将通信加密。HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer, 安全套接层）或 TSL （Transport Layer Security, 安全传输协议）的组合使用，加密 HTTP 的通信内容。
用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信了。与 SSL 组合使用的 HTTP 被称为 HTTPS（HTTP Secure,超文本传输安全协议） 或 HTTP over SSL。


**内容的加密：**
还有一种将参与通信的内容本身加密的方式。由于 HTTP 协议中没有加密机制，那么就对 HTTP 协议传输的内容本身加密。即把 HTTP 报文里面所含的内容进行加密处理。对发送请求和响应的内容都需要加密，所以前提要求客户端和服务端同时具备加密和解密机制。主要是应用在 Web 服务中。这里，因为这种加密方式不同于 SSL 或者 TLS 将整个通信线路加密，所以内容仍然有被篡改的风险。


#### 不验证通信方的身份就可能遭遇伪装
HTTP 协议中的请求和响应不会对通信方进行确认，也就是说存在“服务器是否就是发送请求中 URI 真正制定的主机，返回的响应是否真正的返回到实际提出请求的客户端”等类似的问题。

任何人都可以发起请求，HTTP 协议的实现本身比较简单，不论是谁发送过来的请求都会返回响应，因此不确认通信方，会存在以下各种隐患：
- 无法确定请求发送至目标的 web 服务器是否是按真实意图返回响应的那台服务器。有可能是已伪装的 web 服务器。
- 无法确定响应返回到的客户端是否是按真实意图接收响应的那个客户端。有可能是已伪装的客户端。
- 无法确定正在通信的对方是否具备访问权限。因为某些 web 服务器上保存着重要的信息，只想发给特定用户通信的权限。
- 无法判定请求是来自何方、出自谁手。
- 即使是无意义的请求也会照单全收。无法阻止海量请求下的 DDoS 攻击（Denial of Service, 拒绝服务攻击）。

**解决方案，查明对方证书**
如果使用了 SSL 了就可以，SSL 不仅提供加密处理，而且还使用了一种被称为证书的手段，可用于确定通信方。
证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方（服务器或者客户端）持有的证书，即可以判断通信方的真实意图。
通过使用证书，以证明通信方就是意料中的服务器。这对使用者个人来讲，也减少了个人信息泄露的危险性。另外，客户端持有证书即可完成个人身份的确认，也可用于对 web 网站的认证环节。


#### 无法证明报文完整性，可能已遭篡改
完整性是指信息的准确度。若无法证明其完整性，通常也意味着无法判断信息是否准确。

**接收到的内容可能有误**
由于 HTTP 协议无法证明通信的报文完整性，因此，在请求或响应送出之后知道对方接收之前的这段时间内，即使请求或响应的内容遭到篡改，也没有办法知道。换句话说，没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后相同的。
比如：从某个 web 网站上下载内容是无法确定客户端下载的文件和服务器上存放的文件是否前后一致。文件内容在传输途中有可能已经被篡改为其他内容。即使内容真的已经改变，作为接收方的客户端也察觉不到。

**如何防止篡改**
虽然有使用 HTTP 协议确定报文完整性的方法，但事实上并不便捷、可靠。其中常用的是 MD5 和 SHA-1 等散列值校验的方法，以及用来确认文件的数字签名方法。

可惜用这些方法也无法百分百保证确认结果正确。因为如果加密算法本身如果被改写的话，用户是没有办法意识到的。

为了有效防止这些弊端，有必要使用 HTTPS。SSL提供认证和机密处理以及摘要功能。仅靠 HTTP 确认完整性是非常困难的，隐藏通过和其他协议组合使用来实现这个目标。

### HTTP + 加密 + 认证 + 完整性保护 = HTTPS
#### HTTP 经过加密处理、认证、完整性包含后就是 HTTPS
如果在 HTTP 协议通信过程中使用未经加密的明文，比如在 web 页面中输入信用卡好，如果这条通信线路遭到窃听，那么信用卡号就暴露了。另外，对于 HTTP 来说，服务器也好，客户端也好，都是没有办法确认通信方的。因为很有可能病史和原本预想的通信方进行通信。并且还需要考虑到接到的报文在通信途中已经遭到篡改的可能性。
为了统一解决这些问题，需要在 HTTP 上再加入加密处理和认证等机制。我们把天津了加密及认证机制的 HTTP 称为 HTTPS（http secure）。经常在 web 的登录页面和购物结算页面等使用 HTTPS 通信。甚至是全站都使用 HTTPS。用 HTTPS 通信是，不再用`http://` 而是用`https://`。另外，当流浪器访问 HTTPS 通信有效的 web 网站时，浏览器的地址会出现一个带锁`🔐`的标记。

#### HTTPS 是身披 SSL 外壳的 HTTP
HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代替而已。
通常，HTTP 直接和 TCP 通信，当使用 SSL时，则演变成先和 SSL通信，再由 SSL 和 TCP 通信，简而言之，所谓的 HTTPS，就是身披 SSL协议这层外壳的 HTTP。

|应用（HTTP）|  vs    |应用（HTTP）| 
|:--:|  :--:   |:--:|
|TCP|    -    |SSL|
|IP|    -    |TCP|  
||     -   |IP|     

在采用 SSL 后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护这些功能。SSL 是独立于 HTTP 的协议，所以不光是 HTTPx协议，其他运行在应用层的 SMTP 和 Telnet 等协议均可以配合 SSL 协议使用。可以说 SSL 是当今世界上应用最为广泛的网络安全技术。

#### 相互交换密钥的公开密钥加密技术
在对 SSL 进行说明之前，我们了解下加密方法。SSL 采用一种叫做公开密钥加密（Public-key cryptography）的加密处理方式。近代的加密方法中加密算法是公开的，而密钥确实保密的。通过这种方式得以保持加密方法的安全性。
加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。

**共享密钥加密的困境：**
机密和解密用同一个密钥的方式称为共享密钥加密（Common-key crypto system）,也被叫做对称密钥加密。
以共享密钥方式加密时必须将密钥发送给对方。可究竟怎样才能安全地转交。在互联网上转发密钥时，如果通信被监听那么密钥就可能会落入攻击人的受众，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥。

**使用两把密钥的公开密钥加密**
公开密钥的加密方式很好地解决了共享密钥加密的困难。公开密钥加密使用一对非对称的密钥。一把叫私有密钥（private key）,另外一把叫做公开密钥（public key）。顾名思义，私有密钥不能让其他任何人知道，而公开密钥则可以随意发布，任何人都可以获得。
使用公开密钥加密方式，发送密文的一方使用对方的公开密钥进行加密处理，对方收到被加密的信息后，再使用自己的私有密钥进行解密。利用这种方式，不需要发送用来解密的私有密钥，也就不必担心密钥被攻击者窃听而盗走。
另外，想要根据密文和公开密钥，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到的，退一步讲，如果能对一个非常大的整数做到快速因式分解，那么密码破解还是存在希望的。但就目前的技术来看是不太现实的。

**HTTPS 采用混合加密机制**
HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。但是公开密钥加密与共享密钥加密相比，其速度要慢。所以应充分利用两者各自的优势，将多种方法组合起来用于通信。在交换密钥环节使用公开密钥加密方式，之后的简历通信交换报文阶段则使用共享密钥加密方式。

`注：`公开密钥加密处理起来比共享密钥方式更为复杂，因策若在通信时使用公开密钥加密方式，效率就很低。












